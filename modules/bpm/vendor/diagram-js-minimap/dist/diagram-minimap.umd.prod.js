!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DiagramJSMinimap=e()}(this,(function(){"use strict";function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}function e(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}const n=Object.prototype.toString;function i(t){return new o(t)}function o(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}o.prototype.add=function(t){return this.list.add(t),this},o.prototype.remove=function(t){return"[object RegExp]"==n.call(t)?this.removeMatching(t):(this.list.remove(t),this)},o.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},o.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},o.prototype.array=function(){return Array.from(this.list)},o.prototype.has=o.prototype.contains=function(t){return this.list.contains(t)};var r,a,s,l={};function c(){r=window.addEventListener?"addEventListener":"attachEvent",a=window.removeEventListener?"removeEventListener":"detachEvent",s="addEventListener"!==r?"on":""}var h,u=t({__proto__:null,bind:l.bind=function(t,e,n,i){return r||c(),t[r](s+e,n,i||!1),n},unbind:l.unbind=function(t,e,n,i){return a||c(),t[a](s+e,n,i||!1),n},default:l},[l]);function d(t,e){return(e=e||document).querySelector(t)}function p(t,e){return function(t,e){e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}(e,t),t}"undefined"!=typeof document&&((h=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',h.getElementsByTagName("link").length,h=void 0);var f=2,g={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":f,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":f,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function v(t,e,n){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=g[i];o?(o===f&&"number"==typeof n&&(n=String(n)+"px"),t.style[i]=n):t.setAttributeNS(null,e,n)}function m(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return g[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);v(t,e,n)}else!function(t,e){var n,i,o=Object.keys(e);for(n=0;i=o[n];n++)v(t,i,e[i])}(t,e);return t}const _=Object.prototype.toString;function y(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}y.prototype.add=function(t){return this.list.add(t),this},y.prototype.remove=function(t){return"[object RegExp]"==_.call(t)?this.removeMatching(t):(this.list.remove(t),this)},y.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},y.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},y.prototype.array=function(){return Array.from(this.list)},y.prototype.has=y.prototype.contains=function(t){return this.list.contains(t)};var w={svg:"http://www.w3.org/2000/svg"},x='<svg xmlns="'+w.svg+'"';function b(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(w.svg)&&(t=x+t.substring(4)):(t=x+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var i=document.createDocumentFragment(),o=n.firstChild;o.firstChild;)i.appendChild(o.firstChild);return i}function C(t,e){var n;return"<"===(t=t.trim()).charAt(0)?(n=b(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(w.svg,t),e&&m(n,e),n}const R=Object.prototype.toString,E=Object.prototype.hasOwnProperty;function D(t,e){return E.call(t,e)}function M(t,e){let n,i;if(void 0===t)return;const o=function(t){return"[object Array]"===R.call(t)}(t)?k:O;for(let r in t)if(D(t,r)&&(n=t[r],i=e(n,o(r)),!1===i))return n}function j(t,e){return!!function(t,e,n){return M(t,(function(t,i){n=e(n,t,i)})),n}(t,(function(t,n,i){return t&&e(n,i)}),!0)}function O(t){return t}function k(t){return Number(t)}function B(t,...e){return Object.assign(t,...e)}function P(t){return CSS.escape(t)}function A(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}A.prototype.next=function(){return this._prefix+ ++this._counter};var N=new A,V={min:.2,max:4};function I(t,e,n,i,o){var r=this;function a(t){r._state._svgClientRect&&!T(r._state._svgClientRect)||(r._state._svgClientRect=r._svg.getBoundingClientRect()),z(S({x:t.x-r._state._svgClientRect.left,y:t.y-r._state._svgClientRect.top},r._svg,r._lastViewbox),r._canvas),r._update()}function s(t){return function(e){var n=$(e);r._state._svgClientRect&&!T(r._state._svgClientRect)||(r._state._svgClientRect=r._svg.getBoundingClientRect()),t&&a(n);var o=S({x:n.x-r._state._svgClientRect.left,y:n.y-r._state._svgClientRect.top},r._svg,r._lastViewbox),s=i.viewbox(),h=function(t,e){var n={x:e.x+e.width/2,y:e.y+e.height/2};return{x:t.x-n.x,y:t.y-n.y}}(o,s),d=r._viewportDom.getBoundingClientRect(),p={x:n.x-d.left+1,y:n.y-d.top+1};B(r._state,{cachedViewbox:s,initialDragPosition:{x:n.x,y:n.y},isDragging:!0,offsetViewport:h,offsetViewportDom:p,viewportClientRect:r._viewport.getBoundingClientRect(),parentClientRect:r._parent.getBoundingClientRect()}),u.bind(document,"mousemove",l),u.bind(document,"mouseup",c)}}function l(t){var e=$(t);if(r._state.isDragging){r._state._svgClientRect&&!T(r._state._svgClientRect)||(r._state._svgClientRect=r._svg.getBoundingClientRect());var n=r._state.offsetViewportDom,i=r._state.viewportClientRect,o=r._state.parentClientRect;B(r._viewportDom.style,{top:e.y-n.y-o.top+"px",left:e.x-n.x-o.left+"px"});var a=Y(o,{top:e.y-n.y-o.top,left:e.x-n.x-o.left,width:i.width,height:i.height});B(r._overlay.style,{clipPath:a});var s=S({x:e.x-r._state._svgClientRect.left,y:e.y-r._state._svgClientRect.top},r._svg,r._lastViewbox);z({x:s.x-r._state.offsetViewport.x,y:s.y-r._state.offsetViewport.y},r._canvas)}}function c(t){var e=$(t);r._state.isDragging&&(r._state.initialDragPosition.x===e.x&&r._state.initialDragPosition.y===e.y&&a(t),r._update(),B(r._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),u.unbind(document,"mousemove",l),u.unbind(document,"mouseup",c))}this._canvas=i,this._elementRegistry=o,this._eventBus=n,this._injector=e,this._state={isOpen:void 0,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0},this._minimapId=N.next(),this._init(),this.toggle(t&&t.open||!1),u.bind(this._viewportDom,"mousedown",s(!1)),u.bind(this._svg,"mousedown",s(!0)),u.bind(this._parent,"wheel",(function(t){if(t.preventDefault(),t.stopPropagation(),t.ctrlKey&&(r._state._svgClientRect&&!T(r._state._svgClientRect)||(r._state._svgClientRect=r._svg.getBoundingClientRect()),e=t,n=r._state._svgClientRect,e.x>n.left&&e.x<n.left+n.width&&e.y>n.top&&e.y<n.top+n.height)){var e,n,o,a,s,l,c=0===t.deltaMode?.02:.32,h=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*q(t.deltaY)*-c;if(r._state.zoomDelta+=h,Math.abs(r._state.zoomDelta)>.1){var u=h>0?1:-1,d=Math.log(i.zoom())/Math.log(10),p=(o=V,a=20,s=Math.log(o.min)/Math.log(10),l=Math.log(o.max)/Math.log(10),(Math.abs(s)+Math.abs(l))/a),f=Math.round(d/p)*p;f+=p*u;var g=Math.pow(10,f);i.zoom(function(t,e){return Math.max(t.min,Math.min(t.max,e))}(V,g),v),r._state.zoomDelta=0;var v=S({x:t.clientX-r._state._svgClientRect.left,y:t.clientY-r._state._svgClientRect.top},r._svg,r._lastViewbox);z(v,r._canvas),r._update()}}})),u.bind(this._toggle,"click",(function(t){t.preventDefault(),t.stopPropagation(),r.toggle()})),n.on(["shape.added","connection.added"],(function(t){var e=t.element;r._addElement(e),r._update()})),n.on(["shape.removed","connection.removed"],(function(t){var e=t.element;r._removeElement(e),r._update()})),n.on("elements.changed",250,(function(t){t.elements.forEach((function(t){r._updateElement(t)})),r._update()})),n.on("element.updateId",(function(t){var e=t.element,n=t.newId;r._updateElementId(e,n)})),n.on("canvas.viewbox.changed",(function(){r._state.isDragging||r._update()})),n.on("canvas.resized",(function(){document.body.contains(r._parent)&&(r._state.isDragging||r._update(),r._state._svgClientRect=r._svg.getBoundingClientRect())})),n.on(["root.set","plane.set"],(function(t){r._clear(),(t.element||t.plane.rootElement).children.forEach((function(t){r._addElement(t)})),r._update()}))}function S(t,e,n){var i=e.getBoundingClientRect(),o=function(t,e){var n=t.width/t.height,i=B({},{x:t.x,y:t.y,width:t.width,height:t.height});if(n>e){var o=i.width*(1/e);B(i,{y:i.y-(o-i.height)/2,height:o})}else if(n<e){var r=i.height*e;B(i,{x:i.x-(r-i.width)/2,width:r})}return i}(n,i.width/i.height);return{x:G(t.x,0,i.width,o.x,o.x+o.width),y:G(t.y,0,i.height,o.y,o.y+o.height)}}function z(t,e){var n=e.viewbox(),i=n.width,o=n.height;e.viewbox({x:t.x-i/2,y:t.y-o/2,width:i,height:o})}function G(t,e,n,i,o){return(t-e)*(o-i)/(n-e)+i}function L(t,e,n){var i=function(t){var e=d(".children",t);e||p(t,e=C("g",{class:"children"}));return e}(e),o=[].slice.call(i.childNodes)[n];o?e.insertBefore(t,o.nextSibling):e.appendChild(t)}function T(t){return 0===t.width&&0===t.height}I.$inject=["config.minimap","injector","eventBus","canvas","elementRegistry"],I.prototype._init=function(){var t=this._canvas.getContainer(),e=this._parent=document.createElement("div");i(e).add("djs-minimap"),t.appendChild(e);var n=this._toggle=document.createElement("div");i(n).add("toggle"),e.appendChild(n);var o=this._map=document.createElement("div");i(o).add("map"),e.appendChild(o);var r=this._svg=C("svg");m(r,{width:"100%",height:"100%"}),p(o,r),p(r,this._elementsGroup=C("g"));var a=this._viewportGroup=C("g");p(r,a);var s,l=this._viewport=C("rect");(s=l,new y(s)).add("viewport"),p(a,l),u.bind(e,"mousedown",(function(t){t.stopPropagation()}));var c=this._viewportDom=document.createElement("div");i(c).add("viewport-dom"),this._parent.appendChild(c);var h=this._overlay=document.createElement("div");i(h).add("overlay"),this._parent.appendChild(h)},I.prototype._update=function(){var t=this._canvas.viewbox(),e=t.inner,n=t.outer;if(X(t)){var i,o,r,a,s=n.width-e.width,l=n.height-e.height;e.width<n.width?(i=e.x-s/2,r=n.width,e.x+e.width<n.width&&(i=Math.min(0,e.x))):(i=e.x,r=e.width),e.height<n.height?(o=e.y-l/2,a=n.height,e.y+e.height<n.height&&(o=Math.min(0,e.y))):(o=e.y,a=e.height),i-=50,o-=50,r+=100,a+=100,this._lastViewbox={x:i,y:o,width:r,height:a},m(this._svg,{viewBox:i+", "+o+", "+r+", "+a}),m(this._viewport,{x:t.x,y:t.y,width:t.width,height:t.height});var c=this._state._parentClientRect=this._parent.getBoundingClientRect(),h=this._viewport.getBoundingClientRect(),u={top:h.top-c.top,left:h.left-c.left,width:h.width,height:h.height};B(this._viewportDom.style,{top:u.top+"px",left:u.left+"px",width:u.width+"px",height:u.height+"px"});var d=Y(c,u);B(this._overlay.style,{clipPath:d})}},I.prototype.open=function(){B(this._state,{isOpen:!0}),i(this._parent).add("open");var t=this._injector.get("translate",!1)||function(t){return t};e(this._toggle,"title",t("Close minimap")),this._update(),this._eventBus.fire("minimap.toggle",{open:!0})},I.prototype.close=function(){B(this._state,{isOpen:!1}),i(this._parent).remove("open");var t=this._injector.get("translate",!1)||function(t){return t};e(this._toggle,"title",t("Open minimap")),this._eventBus.fire("minimap.toggle",{open:!1})},I.prototype.toggle=function(t){var e=this.isOpen();void 0===t&&(t=!e),t!=e&&(t?this.open():this.close())},I.prototype.isOpen=function(){return this._state.isOpen},I.prototype._updateElement=function(t){try{void 0!==t.parent&&null!==t.parent&&(this._removeElement(t),this._addElement(t))}catch(t){console.warn("Minimap#_updateElement errored",t)}},I.prototype._updateElementId=function(t,e){try{var n=d("#"+P(this._prefixId(t.id)),this._elementsGroup);n&&(n.id=this._prefixId(e))}catch(t){console.warn("Minimap#_updateElementId errored",t)}},I.prototype.isOnActivePlane=function(t){var e=this._canvas;return e.findRoot?e.findRoot(t)===e.getRootElement():!e.findPlane||e.findPlane(t)===e.getActivePlane()},I.prototype._addElement=function(t){var e=this;if(this._removeElement(t),this.isOnActivePlane(t)){var n,i,o,r=this._createElement(t),a=d("#"+P(this._prefixId(t.parent.id)),this._elementsGroup);if(r){var s=function(t,e){var n=d(".djs-children",e.parentNode);if(!n)return;var i=[].slice.call(n.childNodes),o=-1;return i.forEach((function(e,n){d(".djs-element",e)===t&&(o=n)})),o}(this._elementRegistry.getGraphics(t),this._elementRegistry.getGraphics(t.parent));return"undefined"!==s&&a?a.childNodes.length>s?L(r,a,s):L(r,a,a.childNodes.length-1):this._elementsGroup.appendChild(r),!function(t){return t.waypoints}(t)?(i=t.x,o=t.y,a&&(i-=(n=t.parent).x,o-=n.y),m(r,{transform:"translate("+i+" "+o+")"})):(i=0,o=0,void 0!==(n=t.parent).x&&void 0!==n.y&&(i=-n.x,o=-n.y),m(r,{transform:"translate("+i+" "+o+")"})),t.children&&t.children.length&&t.children.forEach((function(t){e._addElement(t)})),r}}},I.prototype._removeElement=function(t){var e=this._svg.getElementById(this._prefixId(t.id));e&&function(t){var e=t.parentNode;e&&e.removeChild(t)}(e)},I.prototype._createElement=function(t){var e,n=this._elementRegistry.getGraphics(t);if(n&&(e=function(t){return t.childNodes[0]}(n),e)){var i=function(t){return function(t,e){return(e=e||document).querySelectorAll(t)}("[id]",t).forEach((function(t){t.remove()})),t}(function(t){return t.cloneNode(!0)}(e));return m(i,{id:this._prefixId(t.id)}),i}},I.prototype._clear=function(){!function(t){for(var e;e=t.firstChild;)t.removeChild(e)}(this._elementsGroup)},I.prototype._prefixId=function(t){return"djs-minimap-"+t+"-"+this._minimapId};var q=Math.sign||function(t){return t>=0?1:-1};function Y(t,e){return"polygon("+[F(e.left,e.top),F(e.left+e.width,e.top),F(e.left+e.width,e.top+e.height),F(e.left,e.top+e.height),F(e.left,t.height),F(t.width,t.height),F(t.width,0),F(0,0),F(0,t.height),F(e.left,t.height)].join(", ")+")"}function F(t,e){return t+"px "+e+"px"}function X(t){return j(t,(function(t){return e=t,"[object Object]"===R.call(e)?X(t):function(t){return"[object Number]"===R.call(t)}(t)&&isFinite(t);var e}))}function $(t){return t.center?t.center:{x:t.clientX,y:t.clientY}}return{__init__:["minimap"],minimap:["type",I]}}));
